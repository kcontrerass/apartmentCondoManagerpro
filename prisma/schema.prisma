generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

// Enums
enum Role {
  SUPER_ADMIN
  ADMIN
  OPERATOR
  GUARD
  RESIDENT
}

enum UserStatus {
  ACTIVE
  INACTIVE
  SUSPENDED
}

enum ComplexType {
  BUILDING    // Edificio Vertical
  RESIDENTIAL // Residencial Horizontal
  CONDO       // Condominio Mixto
}

enum UnitStatus {
  OCCUPIED
  VACANT
  MAINTENANCE
}

enum ResidentType {
  OWNER
  TENANT
}

enum AmenityType {
  POOL
  GYM
  CLUBHOUSE
  COURT
  BBQ
  OTHER
}

// Models

model User {
  id            String    @id @default(cuid())
  email         String    @unique
  password      String // Hashed
  name          String
  phone         String?
  image         String?   @db.Text
  role          Role      @default(RESIDENT)
  status        UserStatus @default(ACTIVE)
  
  resetPasswordToken   String?   @unique
  resetPasswordExpires DateTime?
  
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  // Relations
  residentProfile Resident?
  managedComplexes Complex[] // For ADMIN role

  @@map("users")
}

model Complex {
  id          String      @id @default(cuid())
  name        String
  address     String      @db.Text
  type        ComplexType @default(BUILDING)
  logoUrl     String?     @map("logo_url")
  settings    Json?       // Flexible settings (colors, rules, etc)
  
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  
  // Relations
  adminId     String?     @unique
  admin       User?       @relation(fields: [adminId], references: [id])
  units       Unit[]
  amenities   Amenity[]

  @@map("complexes")
}

model Unit {
  id          String     @id @default(cuid())
  number      String     // e.g. "101", "A-20"
  type        String?    // e.g. "Apartment", "Penthouse"
  bedrooms    Int        @default(1)
  bathrooms   Float      @default(1.0)
  area        Float?     // in sq meters
  
  status      UnitStatus @default(VACANT)
  
  complexId   String     @map("complex_id")
  complex     Complex    @relation(fields: [complexId], references: [id], onDelete: Cascade)
  
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt

  // Relations
  residents   Resident[]

  @@unique([complexId, number]) // Unit numbers must be unique within a complex
  @@map("units")
}

model Resident {
  id              String       @id @default(cuid())
  type            ResidentType @default(TENANT)
  
  startDate       DateTime     @map("start_date")
  endDate         DateTime?    @map("end_date")
  
  emergencyContact Json?       @map("emergency_contact") // {name, phone, relation}
  
  userId          String       @unique @map("user_id")
  user            User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  unitId          String       @map("unit_id")
  unit            Unit         @relation(fields: [unitId], references: [id], onDelete: Cascade)
  
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt

  @@map("residents")
}

model Amenity {
  id             String      @id @default(cuid())
  name           String
  description    String?     @db.Text
  type           AmenityType @default(OTHER)
  
  capacity       Int?
  operatingHours Json?       @map("operating_hours") // {open, close, days}
  
  costPerDay     Decimal?    @map("cost_per_day") @db.Decimal(10, 2)
  costPerHour    Decimal?    @map("cost_per_hour") @db.Decimal(10, 2)
  
  complexId      String      @map("complex_id")
  complex        Complex     @relation(fields: [complexId], references: [id], onDelete: Cascade)
  
  createdAt      DateTime    @default(now())
  updatedAt      DateTime    @updatedAt

  @@map("amenities")
}
